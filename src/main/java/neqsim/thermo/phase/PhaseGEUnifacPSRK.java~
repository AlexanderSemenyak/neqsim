/*
 * PhaseGEUniquac.java
 *
 * Created on 11. juli 2000, 21:01
 */

package thermo.phase;

import thermo.component.*;

/**
 *
 * @author  Even Solbraa
 * @version
 */
public class PhaseGEUnifacPSRK extends PhaseGEUnifac{
    
    /** Creates new PhaseGEUniquac */
    
    double[][] bij = new double[1][1];
    double[][] cij = new double[1][1];
    
    public PhaseGEUnifacPSRK() {
        super();
        componentArray = new ComponentGEUnifacPSRK[10];
    }
    
    public PhaseGEUnifacPSRK(PhaseInterface phase, double[][] alpha, double[][] Dij, String[][] mixRule, double[][] intparam) {
        super();
        componentArray = new ComponentGEUnifac[alpha[0].length];
        this.mixRule = mixRule;
        this.alpha = alpha;
        this.Dij = Dij;
        this.intparam = intparam;
        for (int i=0; i < alpha[0].length; i++){
            numberOfComponents++;
            componentArray[i] = new ComponentGEUnifacPSRK(phase.getComponents()[i].getName(), phase.getComponents()[i].getNumberOfmoles(), phase.getComponents()[i].getNumberOfMolesInPhase(), phase.getComponents()[i].getComponentNumber());
        }
    }
    
    public void addcomponent(String componentName, double moles,double molesInPhase,  int compNumber){
        super.addcomponent(molesInPhase);
        componentArray[compNumber] = new ComponentGEUnifacPSRK(componentName, moles, molesInPhase,compNumber);
    }
    
    public void init(double totalNumberOfMoles, int numberOfComponents, int type, int phase, double beta){ // type = 0 start init type =1 gi nye betingelser
        if(type==0){
            checkGroups();
            calcaij();
            calcbij();
            calccij();
        }
        super.init(totalNumberOfMoles, numberOfComponents, type, phase, beta);
    }
    
    
    public double getExessGibbsEnergy(PhaseInterface phase, int numberOfComponents, double temperature, double pressure, int phasetype){
        double GE = 0.0;
        for (int i=0; i < numberOfComponents; i++){
            GE += phase.getComponents()[i].getx()*Math.log(((ComponentGEUnifacPSRK)componentArray[i]).getGamma(phase, numberOfComponents, temperature,  pressure, phasetype));
        }
        return R*phase.getTemperature()*GE*phase.getNumberOfMolesInPhase();//phase.getNumberOfMolesInPhase()*
    }
    
    public void calcbij(){
        bij = new double[((ComponentGEUnifac)getComponent(0)).getNumberOfUNIFACgroups()][((ComponentGEUnifac)getComponent(0)).getNumberOfUNIFACgroups()];
        for (int i=0; i < ((ComponentGEUnifac)getComponent(0)).getNumberOfUNIFACgroups(); i++){
            for (int j=0; j < ((ComponentGEUnifac)getComponent(0)).getNumberOfUNIFACgroups(); j++){
                try{
                    util.database.NeqSimDataBase database = new util.database.NeqSimDataBase();
                    java.sql.ResultSet dataSet = null;
                    try{
                        dataSet =  database.getResultSet(("SELECT * FROM UNIFACInterParamB WHERE MainGroup="+((ComponentGEUnifac)getComponent(0)).getUnifacGroup(i).getMainGroup() + ""));
                        dataSet.next();
                        dataSet.getClob("MainGroup");
                    }
                    catch(Exception e){
                        dataSet.close();
                        dataSet =  database.getResultSet(("SELECT * FROM UNIFACInterParamB WHERE MainGroup="+((ComponentGEUnifac)getComponent(0)).getUnifacGroup(i).getMainGroup() + ""));
                        dataSet.next();
                    }
                    
                    bij[i][j] = Double.parseDouble(dataSet.getString("n"+((ComponentGEUnifac)getComponent(0)).getUnifacGroup(j).getMainGroup()+""));
                    //System.out.println("aij " + aij[i][j]);
                    dataSet.close();
                    database.getConnection().close();
                }
                
                catch (Exception e) {
                    String err = e.toString();
                    System.out.println(err);
                }
            }
        }
    }
    
    public void calccij(){
        cij = new double[((ComponentGEUnifac)getComponent(0)).getNumberOfUNIFACgroups()][((ComponentGEUnifac)getComponent(0)).getNumberOfUNIFACgroups()];
        for (int i=0; i < ((ComponentGEUnifac)getComponent(0)).getNumberOfUNIFACgroups(); i++){
            for (int j=0; j < ((ComponentGEUnifac)getComponent(0)).getNumberOfUNIFACgroups(); j++){
                try{
                    util.database.NeqSimDataBase database = new util.database.NeqSimDataBase();
                    java.sql.ResultSet dataSet = null;
                    try{
                        dataSet =  database.getResultSet(("SELECT * FROM UNIFACInterParamC WHERE MainGroup="+((ComponentGEUnifac)getComponent(0)).getUnifacGroup(i).getMainGroup() + ""));
                        dataSet.next();
                        dataSet.getClob("MainGroup");
                    }
                    catch(Exception e){
                        dataSet.close();
                        dataSet =  database.getResultSet(("SELECT * FROM UNIFACInterParamC WHERE MainGroup="+((ComponentGEUnifac)getComponent(0)).getUnifacGroup(i).getMainGroup() + ""));
                        dataSet.next();
                    }
                    
                    cij[i][j] = Double.parseDouble(dataSet.getString("n"+((ComponentGEUnifac)getComponent(0)).getUnifacGroup(j).getMainGroup()+""));
                    //System.out.println("aij " + aij[i][j]);
                    dataSet.close();
                    database.getConnection().close();
                }
                
                catch (Exception e) {
                    String err = e.toString();
                    System.out.println(err);
                }
            }
        }
    }
    
    
}