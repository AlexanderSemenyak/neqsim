/*
 * PhaseGENRTLmodifiedHV.java
 *
 * Created on 18. juli 2000, 18:32
 */

package thermo.phase;

import thermo.component.*;
/**
 *
 * @author  Even Solbraa
 * @version
 */
public class PhaseGENRTLmodifiedHV extends PhaseGENRTL {
    
    String[][] mixRule;
    double[][] intparam;
    double[][] Dij, DijT;
    int type = 0;
    /** Creates new PhaseGENRTLmodifiedHV */
    
    public PhaseGENRTLmodifiedHV(PhaseInterface phase, double[][] alpha, double[][] Dij, String[][] mixRule, double[][] intparam) {
        super(phase, alpha, Dij, mixRule, intparam);
        componentArray = new ComponentGENRTLmodifiedHV[alpha[0].length];
        this.mixRule = mixRule;
        this.alpha = alpha;
        this.Dij = Dij;
        this.intparam = intparam;
        int type = 0;
        for (int i=0; i < alpha[0].length; i++){
            componentArray[i] = new ComponentGENRTLmodifiedHV(phase.getComponents()[i].getName(), phase.getComponents()[i].getNumberOfmoles(), phase.getComponents()[i].getNumberOfMolesInPhase(), phase.getComponents()[i].getComponentNumber());
        }
    }
    
    public PhaseGENRTLmodifiedHV(PhaseInterface phase, double[][] alpha, double[][] Dij, double[][] DijT, String[][] mixRule, double[][] intparam) {
        super(phase, alpha, Dij, mixRule, intparam);
        componentArray = new ComponentGENRTLmodifiedHV[alpha[0].length];
        this.mixRule = mixRule;
        this.alpha = alpha;
        this.Dij = Dij;
        type = 1;
        this.DijT = DijT;
        this.intparam = intparam;
        for (int i=0; i < alpha[0].length; i++){
            componentArray[i] = new ComponentGENRTLmodifiedHV(phase.getComponents()[i].getName(), phase.getComponents()[i].getNumberOfmoles(), phase.getComponents()[i].getNumberOfMolesInPhase(), phase.getComponents()[i].getComponentNumber());
        }
    }
    
    public void addcomponent(String componentName, double moles, double molesInPhase, int compNumber){
        super.addcomponent(molesInPhase);
        componentArray[compNumber] = new ComponentGENRTLmodifiedHV(componentName, moles, molesInPhase,compNumber);
    }
    
    public void setAlpha(double[][] alpha){
        for(int i=0;i<alpha.length;i++){
            for(int j=0;j<alpha[0].length;j++){
                this.alpha[i][j] = alpha[i][j];
            }
        }
    }
    
    public void setDij(double[][] Dij){
        for(int i=0;i<Dij.length;i++){
            for(int j=0;j<Dij[0].length;j++){
                this.Dij[i][j] = Dij[i][j];
            }
        }
    }
    
    public void setDijT(double[][] DijT){
        for(int i=0;i<DijT.length;i++){
            for(int j=0;j<DijT[0].length;j++){
                this.DijT[i][j] = DijT[i][j];
            }
        }
    }
    
    public double getExessGibbsEnergy(PhaseInterface phase, int numberOfComponents, double temperature, double pressure, int phasetype){
        double GE = 0;
        
        //   ComponentGeNRTLInterface[] comp_Array = new ComponentGeNRTLInterface[phase.getNumberOfComponents()];
        //    comp_Array = (ComponentGeNRTLInterface[]) this.getcomponentArray();
        //   comp_Array = new ComponentGENRTLmodifiedHV(componentArray[.getName());
        for (int i=0; i < numberOfComponents; i++){
            //   componentArray[i] = new ComponentGENRTLmodifiedHV(phase.getComponents()[i].getName(), phase.getComponents()[i].getNumberOfmoles(), phase.getComponents()[i].getNumberOfMolesInPhase(), phase.getComponents()[i].getComponentNumber());
            //    componentArray.init(temperature, pressure, phase.getComponents()[i].getNumberOfmoles(), phase.getBeta(), phaseType);
            if(type==0)
                GE += phase.getComponents()[i].getx()*Math.log(((ComponentGENRTLmodifiedHV) componentArray[i]).getGamma(phase, numberOfComponents, temperature,  pressure, phasetype, alpha, Dij, intparam, mixRule));
            if(type==1)
                GE += phase.getComponents()[i].getx()*Math.log(((ComponentGENRTLmodifiedHV) componentArray[i]).getGamma(phase, numberOfComponents, temperature,  pressure, phasetype, alpha, Dij, DijT, intparam, mixRule));
            
           // System.out.println("gamma i : " + componentArray[i].getx());
        }
        //System.out.println("ge : " + R*temperature*GE*phase.getNumberOfMolesInPhase());
        return R*phase.getTemperature()*GE*phase.getNumberOfMolesInPhase();//phase.getNumberOfMolesInPhase()*
    }
    
}