package util.database;

/*
 * testPointbase.java
 *
 * Created on 1. november 2001, 08:56
 */

import java.sql.*;
import java.io.*;
/**
 *
 * @author  esol
 * @version
 */
public class NeqSimDataBase implements util.util.FileSystemSettings{
    
    static boolean started = false;
    protected Connection databaseConnection;
    public static boolean useOnlineBase = false;
    static int numb=0;
    Statement statement = null;
    
    /** Creates new testPointbase */
    public NeqSimDataBase() {
        try{
            if(useOnlineBase){
                //Class.forName("org.gjt.mm.mysql.Driver");
            }
            else{
                numb++;
                if(numb==1) Class.forName("sun.jdbc.odbc.JdbcOdbcDriver");
            }
            databaseConnection = this.openConnection("NeqSimDatabase");
            statement = databaseConnection.createStatement();
            
        }
        catch(Exception e){
            System.out.println("error in NeqSimDataBase " +e.toString());
            System.out.println("The database must be rgistered on the local DBMS to work.");
        }
    }
    /** Creates new NeqSimDataBase */
    
    public Connection openConnection(String database) throws SQLException, ClassNotFoundException{
        if(useOnlineBase){
            Class.forName("org.gjt.mm.mysql.Driver");
            return DriverManager.getConnection("jdbc:mysql:" + database);
        }
        else{
            String dir="";
            if(System.getProperty("NeqSim.home")==null){
                dir = "z:\\java\\neqsim";
            }
            else{
                dir =  System.getProperty("NeqSim.home");
            }
            return DriverManager.getConnection("jdbc:odbc:DRIVER={Microsoft Access Driver (*.mdb)};DBQ="+dir+"\\data\\"+database);
            //return DriverManager.getConnection("jdbc:odbc:NeqSimDatabase");
        }
    }
    
    public Connection getConnection(){
        return databaseConnection;
    }
    
    public ResultSet getResultSet(String database, String sqlString){
        try{
            ResultSet result =  statement.executeQuery(sqlString);
            return result;
        }
        catch(Exception e){
            System.out.println("error in NeqSimDataBase " +e.toString());
            System.out.println("The database must be rgistered on the local DBMS to work.");
        }
        return null;
    }
    
    public ResultSet getResultSet(String sqlString){
        return this.getResultSet("NeqSimDatabase",sqlString);
    }
    
    public void execute(String sqlString){
        try{
            if(databaseConnection==null){
                databaseConnection = this.openConnection("NeqSimDatabase.mdb");
                statement = databaseConnection.createStatement();
            }
            statement.execute(sqlString);
        }
        catch(Exception e){
            System.out.println("error in NeqSimDataBase " +e.toString());
            System.out.println("The database must be rgistered on the local DBMS to work.");
        }
    }
    
    public static void main(String[] args){
        NeqSimDataBase database = new NeqSimDataBase();
        ResultSet dataSet =  database.getResultSet("NeqSimDataBase",  "SELECT * FROM comp where name='water'");
        try{
            dataSet.next();
            System.out.println("dataset " + dataSet.getString("molarmass"));
        }
        catch(Exception e){System.out.println("failed " + e.toString());}
        System.out.println("ok");
    }
}